daml 1.2

module Test where

import Davl
import DA.Date as Date

can_offer_holiday = scenario do
  boss <- getParty "boss"
  employee <- getParty "employee"
  submit boss $ create $ Gift { allocation = Holiday { boss, employee } }

can_accept_holiday_offer = scenario do
  boss <- getParty "boss"
  employee <- getParty "employee"
  offer <- submit boss $ create $ Gift { allocation = Holiday { boss, employee } }
  submit employee do
    exercise offer Gift_Claim

no_double_spend = scenario do
  boss <- getParty "boss"
  employee <- getParty "employee"
  offer <- submit boss $ create $ Gift { allocation = Holiday { boss, employee } }
  alloc <- submit employee $ exercise offer Gift_Claim
  request1 <- submit employee $ create $ Request { employee, boss, allocationId = alloc, date = Date.date 2019 Date.Apr 11 }
  request2 <- submit employee $ create $ Request { employee, boss, allocationId = alloc, date = Date.date 2019 Date.Apr 12 }
  submit boss $ exercise request1 Request_Approve
  submitMustFail boss $ exercise request2 Request_Approve
